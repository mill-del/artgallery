{% extends 'base.html' %}

{% block content %}
<div class="post-detail">
    <h5>{{ post.title }}</h5>
    <p>{{ post.content }}</p>
    {% if post.image %}
        <img src="{{ url_for('static', filename='uploads/' + post.image) }}" alt="Post image">
    {% endif %}
    <p><small class="text-muted">Posted by {{ post.author.username }} on {{ post.date_posted.strftime('%Y-%m-%d') }}</small></p>
    {% if session['user_id'] == post.user_id %}
        <a href="{{ url_for('blog.edit_post', post_id=post.id) }}" class="btn btn-primary">Edit</a>
        <button class="btn btn-danger delete-post-btn" data-post-id="{{ post.id }}" data-bs-toggle="modal" data-bs-target="#deleteModal" onclick="setDeletePostId({{ post.id }})">Delete</button>
    {% endif %}
    <a href="{{ url_for('blog.home') }}" class="btn btn-secondary mt-3">Back</a>
</div>

<!-- Модальное окно для подтверждения удаления -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this post?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentPostId = null;

    function setDeletePostId(postId) {
        currentPostId = postId;
    }

    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        if (currentPostId) {
            fetch('{{ url_for("blog.delete_post", post_id=0) }}'.replace('0', currentPostId), {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                    modal.hide();
                    window.location.href = '{{ url_for("blog.home") }}';
                    currentPostId = null;
                }
            })
            .catch(error => {
                console.error('Error during delete:', error);
            });
        }
    });
</script>
{% endblock %}